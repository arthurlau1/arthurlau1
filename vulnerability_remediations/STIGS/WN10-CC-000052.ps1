<#
.SYNOPSIS
    Use of weak or untested encryption algorithms undermines the purposes of utilizing encryption to protect data. 
    By default Windows uses ECC curves with shorter key lengths first. 
    Requiring ECC curves with longer key lengths to be prioritized first helps ensure more secure algorithms are used.

.NOTES
    Author          : Arthur Lau
    LinkedIn        : linkedin.com/in/arthur-lau-4a7403172/
    GitHub          : github.com/arthurlau1
    Date Created    : 2025-09-011
    Last Modified   : 2025-09-011
    Date Created    : 2024-09-09
    Last Modified   : 2024-09-09
    Version         : 1.0
    CVEs            : N/A
    Plugin IDs      : N/A
    STIG-ID         : WN10-CC-000052

.TESTED ON
    Date(s) Tested  : 
    Tested By       : 
    Systems Tested  : 
    PowerShell Ver. : 

.USAGE
    Put any usage instructions here.
    Example syntax:
     
#>

# YOUR CODE GOES HERE
$path = "HKLM:\SOFTWARE\Policies\Microsoft\Cryptography\Configuration\SSL\00010002"
$name = "EccCurves"
$desiredValues = @("NistP384", "NistP256")

# --- 1. Ensure registry path exists ---
if (-not (Test-Path $path)) {
    New-Item -Path $path -Force | Out-Null
    Write-Output "Created registry path: $path"
}

# --- 2. Retrieve current value if it exists ---
$currentValues = (Get-ItemProperty -Path $path -Name $name -ErrorAction SilentlyContinue).$name

# --- 3. Check compliance ---
if ($null -ne $currentValues) {
    $isCompliant = ($currentValues -contains "NistP384") -and ($currentValues -contains "NistP256") -and ($currentValues.Count -eq 2)
} else {
    $isCompliant = $false
}

# --- 4. Compliance / Remediation Logic ---
if ($isCompliant) {
    Write-Output "Compliant: $name is correctly set to only NistP384 and NistP256."
}
else {
    # Remediate the ECC curves
    Remove-ItemProperty -Path $path -Name $name -ErrorAction SilentlyContinue
    New-ItemProperty -Path $path -Name $name -Value $desiredValues -PropertyType MultiString -Force | Out-Null
    Write-Output "Remediated: $name set to 'NistP384' and 'NistP256'."
}

Write-Output "Verification complete for STIG ID: WN10-CC-000052"

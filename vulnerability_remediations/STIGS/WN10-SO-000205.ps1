<#
.SYNOPSIS
    The Kerberos v5 authentication protocol is the default for authentication of users who are logging on to domain accounts. 
    NTLM, which is less secure, is retained in later Windows versions for compatibility with clients and servers that are running earlier versions of Windows or applications that still use it. 
    It is also used to authenticate logons to stand-alone computers that are running later versions.

.NOTES
    Author          : Arthur Lau
    LinkedIn        : linkedin.com/in/arthur-lau-4a7403172/
    GitHub          : github.com/arthurlau1
    Date Created    : 2025-09-011
    Last Modified   : 2025-09-011
    Date Created    : 2024-09-09
    Last Modified   : 2024-09-09
    Version         : 1.0
    CVEs            : N/A
    Plugin IDs      : N/A
    STIG-ID         : WN10-SO-000205

.TESTED ON
    Date(s) Tested  : 
    Tested By       : 
    Systems Tested  : 
    PowerShell Ver. : 

.USAGE
    Put any usage instructions here.
    Example syntax:
     
#>

# YOUR CODE GOES HERE
# STIG ID: WN10-SO-000205
# Purpose: Configure LAN Manager Authentication Level (LmCompatibilityLevel) to 5 for maximum security

$path = "HKLM:\SYSTEM\CurrentControlSet\Control\Lsa"
$name = "LmCompatibilityLevel"
$desiredValue = 5

Write-Output "Checking compliance for STIG ID: WN10-SO-000205 ..."

# --- 1. Ensure the registry path exists ---
if (-not (Test-Path $path)) {
    New-Item -Path $path -Force | Out-Null
    Write-Output "Created registry path: $path"
}

# --- 2. Retrieve current registry value ---
$currentValue = (Get-ItemProperty -Path $path -Name $name -ErrorAction SilentlyContinue).$name

# --- 3. Evaluate compliance ---
if ($currentValue -eq $desiredValue) {
    Write-Output "Compliant: $name is already set to $desiredValue (NTLMv2 only; LM and NTLM refused)"
}
else {
    # --- 4. Apply remediation ---
    Set-ItemProperty -Path $path -Name $name -Value $desiredValue -Type DWord

    if ($null -eq $currentValue) {
        Write-Output "Remediated: $name did not exist, created with value $desiredValue"
    }
    else {
        Write-Output "Remediated: $name was $currentValue, changed to $desiredValue"
    }
}

Write-Output "Verification complete for STIG ID: WN10-SO-000205"
